# Spree Avatax (Avalara) Official extension

[![Build Status](https://travis-ci.com/spark-solutions/spree_avatax_official.svg?token=svVk6tYzmvo9CARDPUra&branch=master)](https://travis-ci.com/spark-solutions/spree_avatax_official)

The only officially supported Avatax (Avalara) extension for [Spree Commerce](https://spreecommerce.org/) using [Avalara REST API v2](https://developer.avalara.com/api-reference/avatax/rest/v2/).

## Features

1. Tax calculation (additional/included tax), US state tax, Canadian HST, VAT supported

2. Address validation for US & Canada

3. Commiting complete orders

4. Cancelling (voiding) orders

5. Refunding orders

6. GetByCodeService for getting SalesInvoice for order from Avatax

7. GetTaxService for getting totalTaxCalculated for order from Avatax

8. AvataxLog for logging API calls

9. Caching responses for improved performance

10. Multiple company (store) support

&nbsp;

Developed and maintained by:

[![Spark Solutions](http://sparksolutions.co/wp-content/uploads/2015/01/logo-ss-tr-221x100.png)][spark]

## Installation

1. Add this extension to your `Gemfile` with this line:
  ```ruby
  gem 'spree_avatax_official', github: 'spree-contrib/spree_avatax_official'
  ```

2. Install the gem using Bundler:

  ```bash
  bundle install
  ```

3. Run the install generator

  ```bash
  bundle exec rails g spree_avatax_official:install
  ```

4. Fill up config located in `config/initializers/spree_avatax_official.rb`

5. Restart your server

  If your server was running, restart it so that it can find the assets properly.

## Setup

In order to use `spree_avatax_official` extension, you need to configure your
Avatax credentials. To do so, open spree admin panel and go to **Configurations**
and then **Avatax Settings**.

<img width="1053" alt="Zrzut ekranu 2019-10-15 o 12 46 14" src="https://user-images.githubusercontent.com/581569/66825661-fcd5d000-ef4a-11e9-84b1-993b1a5c1996.png">

Company code, account number and license key can be
configured in the **Avatax Credentials** section of the form.

<img width="1053" alt="Zrzut ekranu 2019-10-16 o 12 20 14" src="https://user-images.githubusercontent.com/581569/66910959-da59ba80-f00f-11e9-8b96-ad2fa45b01ae.png">

* **Account Number:** Provided during your AvaTax account activation process.
* **License Key:** Provided during your AvaTax account activation process.
* **Company Code:** Company profile identifier in the AvaTax Admin Console.

**Service URL** is an URL to connect to the Development or Production AvaTax services. It can be configured in the **Avatax Endpoint urls** section below.

<img width="1053" alt="Zrzut ekranu 2019-10-16 o 12 24 35" src="https://user-images.githubusercontent.com/581569/66911009-fa897980-f00f-11e9-8524-1c64540a9a0f.png">

You can test settings you provided using the **Ping Avatax** button under the form

<img width="1053" alt="Zrzut ekranu 2019-10-16 o 12 25 26" src="https://user-images.githubusercontent.com/581569/66911077-17be4800-f010-11e9-89e0-e1982dd84e25.png">

### Configure Avalra AvaTax

Once connected, you configure additional settings.

<img width="1053" alt="Zrzut ekranu 2019-10-16 o 12 26 54" src="https://user-images.githubusercontent.com/581569/66911217-5c49e380-f010-11e9-86e7-f6fee2f0795d.png">

* **Enable Commiting Transactions:** Enables tax document submission to **Avalara’s AvaTax** service for record keeping. With this setting enabled, transactions will be posted and committed to the **AvaTax Admin Console**.
* **Enable Address Validation:** Option to enable or disable address validation

### Assign an AvaTax System Tax Code to a Tax Category

In order to assign **AvaTax System Tax Code** to **Spree Tax Category**, you need to open **Tax Categories** settings screen (`Configurations -> Tax Categories`), pick up existing or create a new **Tax Category** and fill the **Tax Code** input with the applicable **AvaTax System Tax Code**.

<img width="1053" alt="Zrzut ekranu 2019-10-15 o 12 51 04" src="https://user-images.githubusercontent.com/581569/66825678-095a2880-ef4b-11e9-840c-0a86dbc721b4.png">

If left blank, the **Tax Code** will
default to `P0000000`.

To see a listing of all available **AvaTax System** tax codes, see http://taxcode.avatax.avalara.com

## Migrating from spree_avatax_certified

1. Remove the `spree_avatax_certified` from your `Gemfile`
2. ...

## Testing

First bundle your dependencies, then run `rake`. `rake` will default to building the dummy app if it does not exist, then it will run specs. The dummy app can be regenerated by using `rake test_app`.

```shell
bundle
bundle exec rake
```

When testing your applications integration with this extension you may use it's factories.
Simply add this require statement to your spec_helper:

```ruby
require 'spree_avatax_official/factories'
```

## Contributing

If you'd like to contribute, please take a look at the
[instructions](CONTRIBUTING.md) for installing dependencies and crafting a good
pull request.

## License

Spree Avatax Official is copyright © 2019 [Spark Solutions Sp. z o.o.][spark].
It is free software, and may be redistributed under the terms specified in the
[LICENCE](LICENSE) file.

[LICENSE]: https://github.com/spree-contrib/spree_avatax_official/blob/master/LICENSE

## About Spark Solutions

[![Spark Solutions](http://sparksolutions.co/wp-content/uploads/2015/01/logo-ss-tr-221x100.png)][spark]

Spree Avatax Official is maintained by [Spark Solutions Sp. z o.o.](http://sparksolutions.co?utm_source=github) and
funded by [Avalara Inc.](https://www.avalara.com/us/en/index.html). The names and logos are trademarks of Avalara Inc.

We are passionate about open source software.
We are [available for hire][spark].

[spark]:http://sparksolutions.co?utm_source=github
